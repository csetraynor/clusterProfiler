{
    "collab_server" : "",
    "contents" : "# !diagnostics off\nlibrary(qusage)\nlibrary(AnnotationHub)\n\nlibrary(glmnet)\nlibrary(dplyr)\n\nlibrary(DOSE)\n\nlibrary(org.Hs.eg.db)\ndevtools::document()  ### clusterProfiler\n###### Read Hallmarks\n\nbrca <- readRDS(\"/home/mtr/rfactory/brca_data.RDS\")\nbrca <- readRDS(\"C:/RFactory/Rdata_brca/brca_data.RDS\")\ncvfit <- readRDS(\"C:/RFactory/predsurv/performance_results/ridge2_model_brca_pooled.RDS\")\n\nhallmark_all <- qusage::read.gmt(\"/home/mtr/rfactory/predsurv/vignettes/Gene sets/h.all.v6.1.symbols.gmt\")\n\nhallmark_all <- qusage::read.gmt(\"C:/RFactory/predsurv/vignettes/Gene sets/c6.all.v6.1.symbols.gmt\")\n\nresults <- read.csv(\"/home/mtr/rfactory/predsurv/vignettes/iclust2-vignette/summary_iclust2.csv\")\n\nresults <- read.csv(\"C:/RFactory/predsurv/performance_results/summary_iclust2.csv\")\n\nonco_signature <- ontology_search(hallmark_list = hallmark_all, predictor = results,\n                                  coef = median_coeff)\n\nonco_signature_weight <- ontology_search(hallmark_list = hallmark_all, predictor = results,\n                                         coef = weight)\n\ncapture.output(print(onco_signature), file = \"onco_signature.txt\")\n\n########################### GSEA\n# https://guangchuangyu.github.io/2016/01/go-analysis-using-clusterprofiler/\n\n\n\niclust2 <- brca[brca$intclust == 2, ]\n#rm(brca)\n\n\noptimal <- as.matrix(coef(cvfit, s = \"lambda.min\"))\noptimal <- as.data.frame(optimal)\ncolnames(optimal) <- \"mod\"\noptimal$Hugo_Symbol <- rownames(optimal)\noptimal <- optimal %>% filter(mod!=0)\n\ngenedata <- readr::read_tsv(\"C:/RFactory/Downloads/brca_metabric/data_expression.txt\", col_names = TRUE)\ngeneList <- geneTable$mod\n\n\nif(\"age_std\" %in% optimal$Hugo_Symbol){\n  geneTable <- optimal[(-match(c(\"age_std\", \"npi\"),optimal$Hugo_Symbol)),]\n}else{\n  geneTable <- optimal\n}\n\ngenedata$Entrez_Gene_Id[match(names(geneList), genedata$Hugo_Symbol)]\n\nnames(geneList) <- geneTable$Hugo_Symbol\n\ngene <- genedata$Entrez_Gene_Id[match(names(geneList)[abs(geneList)>quantile(abs(optimal$mod),.5)], genedata$Hugo_Symbol)]\n\ngene.df <- clusterProfiler::bitr(gene, fromType = \"ENTREZID\",\n                                 toType = c(\"ENSEMBL\", \"SYMBOL\"),\n                                 OrgDb = org.Hs.eg.db)\n\nhead(gene.df)\n\nego <- enrichGO(gene          = gene,\n                universe      = names(geneList),\n                OrgDb         = org.Hs.eg.db,\n                ont           = \"CC\",\n                pAdjustMethod = \"BH\",\n                pvalueCutoff  = 0.1,\n                qvalueCutoff  = 0.1)\nhead(summary(ego))\n\nsort(geneList, decreasing = TRUE)\n\nlibrary(DOSE)\n\n\n############give ENTREZID NAME\nnames(geneList) <- genedata$Entrez_Gene_Id[match(names(geneList), genedata$Hugo_Symbol)]\n\nncg <- gseNCG(sort(geneList, decreasing = TRUE),\n           nPerm         = 10,\n           minGSSize     =  2,\n           maxGSSize =  100,\n           pvalueCutoff  = 1,\n           pAdjustMethod = \"BH\",\n           verbose       = TRUE)\n\nncg <- setReadable(ncg, 'org.Hs.eg.db')\nhead(ncg, 3)\n\n\ndotplot(ncg, showCategory=30)\nenrichMap(ncg, vertex.label.cex=1.2, layout=igraph::layout.kamada.kawai)\ncnetplot(ncg, foldChange=geneList)\n\ngene2 <- names(geneList)\nncg2 <- enrichNCG(gene2)\nhead(ncg2)\n\ngsecc <- gseGO(geneList=sort(geneList, decreasing = TRUE),\n               ont=\"BP\",\n               OrgDb=org.Hs.eg.db,\n               verbose=F)\nhead(summary(gsecc))\n\ngseaplot(gsecc,  geneSetID=\"GO:0006414\")\nplotGOgraph(gsecc)\ncnetplot(gsecc, foldChange=geneList)\nenrichMap(gsecc, vertex.label.cex=1.2, layout=igraph::layout.kamada.kawai)\ndotplot(gsecc, showCategory=30)\n",
    "created" : 1526894516276.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "180539901",
    "id" : "51F53AE3",
    "lastKnownWriteTime" : 1526896052,
    "last_content_update" : 1526896052640,
    "path" : "C:/RFactory/clusterProfiler/vignettes/ontology_search.R",
    "project_path" : "vignettes/ontology_search.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}